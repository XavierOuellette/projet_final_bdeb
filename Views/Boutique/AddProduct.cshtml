@model Projet_Finale.Models.Product

<link rel="stylesheet" href="~/css/Login.css">

<div class="container-fluid">
    <div class="row justify-content-center align-items-center" style="height: 100vh;">
        <div class="col-md-7">
            <div class="card">
                <div class="card-body">
                    <img src="/images/LogoNew.PNG" alt="Logo" class="img-fluid mb-4" style="width: 50%; height: auto;">
                    <h2 class="text-center mb-4">Ajouter un item</h2>
                    <div class="form-group">
                        <label for="Name">Nom</label>
                        <input type="text" class="form-control" id="Name" name="Name">
                    </div>
                    <div class="form-group">
                        <label for="Description">Description</label>
                        <textarea class="form-control" id="Description" name="Description"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="Price">Prix</label>
                        <input type="text" class="form-control" id="Price" name="Price">
                    </div>
                    <div class="form-group">
                        <label for="Image">Image</label>
                        <input type="file" class="form-control-file" id="Image" name="Image">
                    </div>
                    <div class="form-group" id="available-group">
                        <label for="Available" id="available-label">Disponible</label>
                        <div class="custom-checkbox">
                            <input type="checkbox" class="" id="Available" name="Available">
                            <label for="Available"></label>
                        </div>
                    </div>

                    <button type="button" class="btn btn-primary btn-block btn-custom" onclick="addProduct()">Ajouter</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    async function addProduct() {
        const name = document.getElementById('Name').value;
        const description = document.getElementById('Description').value;
        const price = document.getElementById('Price').value;
        const image = document.getElementById('Image').files[0];
        const available = document.getElementById('Available').checked;

        const formData = new FormData();
        formData.append('name', name);
        formData.append('description', description);
        formData.append('price', price);
        formData.append('image', image);
        formData.append('available', available);

        try {
            const imageResponse = await fetch('/Boutique/UploadImage', {
                method: 'POST',
                body: formData
            });
            if (imageResponse.ok) {
                const imagePath = await imageResponse.text();

                const productData = {
                    name: name,
                    description: description,
                    price: price,
                    image_path: imagePath,
                    available: available
                };

                const response = await fetch('http://127.0.0.1:5000/insert_item', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(productData)
                });

                if (response.ok) {
                    alert('Produit ajouté avec succès.');
                } else {
                    alert('Une erreur s\'est produite lors de l\'ajout du produit.');
                }
            } else {
                alert('Une erreur s\'est produite lors du téléchargement de l\'image.');
            }
        } catch (error) {
            console.error('Erreur:', error);
            alert('Une erreur s\'est produite lors de l\'ajout du produit.');
        }
    }


</script>
