@model List<User>

@{
    ViewBag.Title = "Gestion utilisateurs";
}
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">

<h2>Gestion Utilisateurs</h2>

<table class="table">
    <thead>
        <tr>
            <th>ID</th>
            <th>Username</th>
            <th>Email</th>
            <th>Role</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var user in Model)
        {
            <tr>
                <td class="id">@user.User_Id</td>
                <td data-field-name="Username" class="editable save">@user.Username</td>
                <td data-field-name="Email" class="editable save">@user.Email</td>
                <td class="editable">
                    <select class="role-dropdown" disabled>
                        @foreach (var role in ViewBag.Roles)
                        {
                            <!option value="@role" @(role == user.Role ? "selected='selected'" : "")>@role</!option>
                        }
                    </select>
                </td>
                <td>
                    <button class="edit-button" data-user-id="@user.User_Id">
                        <i class="bi bi-pencil"></i>
                    </button>
                    <button class="confirm-button" style="display: none;">
                        <i class="bi bi-check"></i>
                    </button>
                    <button class="delete-button">
                        <i class="bi bi-trash"></i>
                    </button>
                    <button class="cancel-button" style="display: none;">
                        <i class="bi bi-x"></i>
                    </button>
                </td>
            </tr>
        }
    </tbody>
</table>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function () {
        // Store initial values
        var initialValues = {};
        var initialRoleValue = {};

        $(".edit-button").click(function () {
            var $row = $(this).closest("tr");
            var userId = $row.find(".id").text();

            if (!initialValues[userId]) {
                initialValues[userId] = {};
            }

            // Store initial values before edit
            $row.find(".save").each(function () {
                var fieldName = $(this).data("field-name");
                initialValues[userId][fieldName] = $(this).text();
            });

            // Store initial dropdown value
            initialRoleValue[userId] = $row.find(".role-dropdown").val();

            // Enable editing
            $row.find(".editable").attr("contenteditable", "true");
            $row.find(".role-dropdown").prop("disabled", false);
            $(this).hide();
            $row.find(".confirm-button").show();
            $row.find(".cancel-button").show();
            $row.find(".delete-button").hide();
        });

        $(".cancel-button").click(function () {
            var $row = $(this).closest("tr");
            var userId = $row.find(".id").text();
            // Restore initial values
            $row.find(".save").each(function () {
                var fieldName = $(this).data("field-name");
                $(this).text(initialValues[userId][fieldName]);
            });

            // Restore initial dropdown value
            $row.find(".role-dropdown").val(initialRoleValue[userId]);

            // Disable editing
            $row.find(".editable").removeAttr("contenteditable");
            $row.find(".role-dropdown").prop("disabled", true);
            $(this).hide();
            $row.find(".edit-button").show();
            $row.find(".confirm-button").hide();
            $row.find(".delete-button").show();
        });

        $(".confirm-button").click(function () {
            var $row = $(this).closest("tr");
            $row.find(".editable").removeAttr("contenteditable");
            $row.find(".role-dropdown").prop("disabled", true);
            $(this).hide();
            $row.find(".edit-button").show();
            $row.find(".cancel-button").hide();
            $row.find(".delete-button").show();
            // Here you can add AJAX to save the changes if needed
        });
    });
</script>